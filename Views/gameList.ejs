<% data.forEach((game) => { %>
    <div class="card">
        <img loading="lazy" src=<%=game.image%>>
        <div class="card-top">
            <span data-title="<%=game.title%>"><p><%=game.title%></p></span>
            <div>
                <p><%=game.reviews%></p>
                <p>⭐</p>
            </div>
        </div>
        <p>€ <%=game.price%></p>
        <%game.genre.forEach((tag) => {%> 
            <p><%=tag%></p>
        <%})%>
        <div>
            <a href="/<%=game.id%>/updateGame"><button>Edit</button></a>
            <a onclick="confirmDelete('<%=game.id%>')" class="pwBtn"><button>Delete</button></a>
        </div>
    </div>
<%})%>

<script>
    function confirmDelete(itemId) {
        const password = prompt("Insert secret password to delete item.");
        if(!password) return;
        
        if(password) {
            fetch(`/${itemId}/delete`, {
                method: "POST",
                headers: {"Content-Type" : "application/json"},
                body: JSON.stringify({password})
            })
            .then(res => res.json())
            .then(data => {
                if(data.success) {
                    alert("Item removed")
                    location.reload();
                } else {
                    alert("Wrong password!");
                }
            })
            .catch(err =>  {
                console.log(err);
                alert("Unforseen Error!")
            })
        }
    }
</script>


